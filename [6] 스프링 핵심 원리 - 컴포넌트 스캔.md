# [6] μ¤ν”„λ§ ν•µμ‹¬ μ›λ¦¬ - μ»΄ν¬λ„νΈ μ¤μΊ”

### ν•™μµ λ©ν‘
1. μ»΄ν¬λ„νΈ μ¤μΊ”κ³Ό μμ΅΄ κ΄€κ³„ μλ™ μ£Όμ…μ„ μ•λ‹¤.
2. μ»΄ν¬λ„νΈ μ¤μΊ”μ νƒμƒ‰ μ„μΉμ™€ κΈ°λ³Έ μ¤μΊ” λ€μƒμ„ μ•λ‹¤.


## 1. μ»΄ν¬λ„νΈ μ¤μΊ”κ³Ό μμ΅΄κ΄€κ³„ μλ™ μ£Όμ… μ‹μ‘ν•κΈ°
  - μ§€κΈκΉμ§€ μ¤ν”„λ§ λΉ λ“±λ΅ μ‹, μλ°” μ½”λ“μ @Bean μ΄λ‚ XMLμ <bean> μ„ ν†µν•΄μ„ μ„¤μ • μ •λ³΄μ— μ§μ ‘ λ“±λ΅ν•  μ¤ν”„λ§ λΉμ„ λ‚μ—΄ν–λ‹¤.
  - μ΄λ ‡κ² λλ©΄, μΌμΌμ΄ λ“±λ΅ ν•΄μ•Όν•λ” κ·€μ°®μμ΄ μλ‹¤.

κ·Έλμ„ μ¤ν”„λ§μ€ μ„¤μ • μ •λ³΄κ°€ μ—†μ–΄λ„ μλ™μΌλ΅ μ¤ν”„λ§ λΉμ„ λ“±λ΅ν•λ” μ»΄ν¬λ„νΈ μ¤μΊ”μ΄λΌλ” κΈ°λ¥μ„ μ κ³µν•λ‹¤.

```java
@Configuration
@ComponentScan(
	excludeFilters = @Filter(type = FilterType.ANNOTATION, classes = Configuration.class)
)
public class AutoAppConfig {

}
```
- μ»΄ν¬λ„νΈ μ¤μΊ”μ„ μ‚¬μ©ν•λ ¤λ©΄, `@ComponentScan` μ„¤μ • μ •λ³΄λ¥Ό λ¶™μ—¬μ£Όλ©΄ λ¨
> μ°Έκ³ 
> - μ»΄ν¬λ„νΈ μ¤μΊ”μ„ μ‚¬μ©ν•λ©΄ `@Configuration` μ΄ λ¶™μ€ μ„¤μ • μ •λ³΄λ„ μλ™μΌλ΅ λ“±λ΅λκΈ° λ•λ¬Έμ—, κΈ°μ΅΄ μμ μ μ„¤μ • μ •λ³΄λ“¤λ„ ν•¨κ» λ“±λ΅λκ³ , μ‹¤ν–‰λμ–΄ λ²„λ¦°λ‹¤
> κ·Έλμ„ μ—¬κΈ°μ„λ” `excludeFilters` λ¥Ό μ‚¬μ©ν•΄μ„ μ„¤μ •μ •λ³΄λ” μ»΄ν¬λ„νΈ μ¤μΊ” λ€μƒμ—μ„ μ μ™Έν•λ‹¤!!
> - `@Configuration` λ„ μ†μ¤μ½”λ“λ¥Ό λ³΄λ©΄ `@Component` μ–΄λ…Έν…μ΄μ…μ΄ λ¶™μ–΄μκΈ° λ•λ¬Έμ— μ»΄ν¬λ„νΈ μ¤μΊ” λ€μƒμ΄ λλ‹¤

- μ΄μ „μ— `AppConfig` μ—μ„λ” `@Bean` μΌλ΅ μ§μ ‘ μ„¤μ • μ •λ³΄λ¥Ό μ‘μ„±ν–κ³ , μμ΅΄ κ΄€κ³„λ„ λ…μ‹ν–λ”λ°, μ§€κΈμ€ μ΄λ° μ„¤μ • μ •λ³΄ μμ²΄κ°€ μ—†κΈ° λ•λ¬Έμ—
- μμ΅΄ κ΄€κ³„ μ£Όμ…λ„ ν΄λμ¤ μ•μ—μ„ λ…μ‹ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤ => `@Autowired` λ΅ μμ΅΄ κ΄€κ³„λ¥Ό μλ™μΌλ΅ μ£Όμ…ν•΄μ¤€λ‹¤!

```java
public class AutoAppConfigTest {

    @Test
    void basicScan() {
        AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(AutoAppConfig.class);

        MemberService memberService = ac.getBean(MemberService.class);
        Assertions.assertThat(memberService).isInstanceOf(MemberService.class);
    }
}
```


### μ»΄ν¬λ„νΈ μ¤μΊ”κ³Ό μλ™ μμ΅΄ κ΄€κ³„ μ£Όμ…μ΄ μ–΄λ–»κ² λ™μ‘ν•λ”μ§€
1. @ComponentScan
![ComponentScan](images/2022/11/componentscan.png)
   - @Componentκ°€ λ¶™μ€ λ¨λ“  ν΄λμ¤λ¥Ό μ¤ν”„λ§ λΉμΌλ΅ λ“±λ΅ν•¨
     - λΉ μ΄λ¦„ κΈ°λ³Έ μ „λµ : ν΄λμ¤λ…μ„ μ‚¬μ©ν•λ, λ§¨ μ•κΈ€μλ§ μ†λ¬Έμλ¥Ό μ‚¬μ©ν•λ‹¤
     - λΉ μ΄λ¦„μ„ μ§μ ‘ μ§€μ •ν•™ μ‹¶μΌλ©΄ `@Component("memberService2")` μ™€ κ°™μ΄ μ΄λ¦„μ„ λ¶€μ—¬ν•λ©΄ λλ‹¤
2. @Autowired μμ΅΄ κ΄€κ³„ μλ™ μ£Όμ…
![Autowired](images/2022/11/autowierd.png)
   - μƒμ„±μμ— @Autowiredλ¥Ό μ§€μ •ν•λ©΄, μ¤ν”„λ§ μ»¨ν…μ΄λ„κ°€ μλ™μΌλ΅ ν•΄λ‹Ή μ¤ν”„λ§ λΉμ„ μ°Ύμ•„μ„ μ£Όμ…ν•¨
   - κΈ°λ³Έ μ΅°ν μ „λµ : νƒ€μ…μ΄ κ°™μ€ λΉμ„ μ°Ύμ•„μ„ μ£Όμ…ν•¨ (`getBean(MemberRepository.class)` μ™€ λ™μΌ)
   - μƒμ„±μμ— νλΌλ―Έν„°κ°€ λ§μ•„λ„ λ‹¤ μ°Ύμ•„μ„ μλ™μΌλ΅ μ£Όμ…ν•λ‹¤

## 2. νƒμƒ‰ μ„μΉμ™€ κΈ°λ³Έ μ¤μΊ” λ€μƒ
- λ¨λ“  μλ°” ν΄λμ¤λ¥Ό λ¨λ‘ μ»΄ν¬λ„νΈ μ¤μΊ”ν•λ©΄ μ‹κ°„μ΄ μ¤λ κ±Έλ¦¬λ―€λ΅, κΌ­ ν•„μ”ν• μ„μΉλ¶€ν„° νƒμƒ‰ν•λ„λ΅ μ‹μ‘ μ„μΉλ¥Ό μ •ν•  μ μλ‹¤.
  ```java
  @ComponentScan(
    basePackages = "hello.core",
  )
  ```
  - basePackage
    - νƒμƒ‰ν•  ν¨ν‚¤μ§€μ μ‹μ‘ μ„μΉλ¥Ό μ§€μ •
    - μ΄ ν¨ν‚¤μ§€λ¥Ό ν¬ν•¨ν•΄μ„ ν•μ„ ν¨ν‚¤μ§€λ¥Ό λ¨λ‘ νƒμƒ‰ν•¨
  - basePackageClasses
    - μ§€μ •ν• ν΄λμ¤μ ν¨ν‚¤μ§€λ¥Ό νƒμƒ‰ μ‹μ‘ μ„μΉλ΅ μ§€μ •
  - λ§μ•½ μ§€μ •ν•μ§€ μ•μΌλ©΄, @ComponentScan μ΄ λ¶™μ€ μ„¤μ • μ •λ³΄ ν΄λμ¤μ ν¨ν‚¤μ§€κ°€ μ‹μ‘ μ„μΉκ°€ λ¨ (`hello.core`)

##### κ¶μ¥ν•λ” λ°©λ²•
- ν¨ν‚¤μ§€ μ„μΉλ¥Ό μ§€μ •ν•μ§€ μ•κ³ , μ„¤μ • μ •λ³΄ ν΄λμ¤μ μ„μΉλ¥Ό ν”„λ΅μ νΈ μµμƒλ‹¨μ— λ‘κΈ°!

### μ»΄ν¬λ„νΈ μ¤μΊ” κΈ°λ³Έ λ€μƒ
- μ»΄ν¬λ„νΈ μ¤μΊ”μ€ `@Component` λΏλ§ μ•„λ‹λΌ λ‹¤μ λ‚΄μ©λ„ μ¶”κ°€λ΅ λ€μƒμ— ν¬ν•¨
  - `@Component` : μ»΄ν¬λ„νΈ μ¤μΊ”μ—μ„ μ‚¬μ©
  - `@Controller` : μ¤ν”„λ§ MVC μ»¨νΈλ΅¤λ¬μ—μ„ μ‚¬μ©
  - `@Service` : μ¤ν”„λ§ λΉ„μ¦λ‹μ¤ λ΅μ§μ—μ„ μ‚¬μ©
  - `@Repository` : μ¤ν”„λ§ λ°μ΄ν„° μ ‘κ·Ό κ³„μΈµμ—μ„ μ‚¬μ©
  - `@Configuration` : μ¤ν”„λ§ μ„¤μ • μ •λ³΄μ—μ„ μ‚¬μ©
> μ°Έκ³ 
> - μ• λ…Έν…μ΄μ…μ—λ” μƒμ†κ΄€κ³„λΌλ” κ²ƒμ΄ μ—†λ‹¤. μ• λ…Έν…μ΄μ…μ΄ νΉμ • μ• λ…Έν…μ΄μ…μ„ λ“¤κ³  μλ” κ²ƒμ„ μΈμ‹ν•  μ μλ” κ²ƒμ€ μλ°” μ–Έμ–΄κ°€ μ§€μ›ν•λ” κΈ°λ¥μ΄ μ•„λ‹λΌ, μ¤ν”„λ§μ΄ μ§€μ›ν•λ” κΈ°λ¥μ΄λ‹¤.



## 3. ν•„ν„°
- μ»΄ν¬λ„νΈ μ¤μΊ”μ—μ„ μ¶”κ°€ν•  λ€μƒ, μ μ™Έν•  λ€μƒμ„ μ§€μ •ν•  μ μλ‹¤
- `includeFilters ` : μ»΄ν¬λ„νΈ μ¤μΊ” λ€μƒμ„ μ¶”κ°€λ΅ μ§€μ •
- `excludeFilters` : μ»΄ν¬λ„νΈ μ¤μΊ”μ—μ„ μ μ™Έν•  λ€μƒμ„ μ§€μ •

### μ»΄ν¬λ„νΈ μ¤μΊ” λ€μƒμ— μ¶”κ°€ν•  μ• λ…Έν…μ΄μ…
```java
@Target(Element.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface MyIncludeComponent {
}
```

```java
@Target(Element.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface MyExcludeComponent {
}
```

```java
@MyIncludeComponent
public class BeanA {}
```

```java
@MyExcludeComponent
public class BeanB {}
```
### μ„¤μ • μ •λ³΄μ™€ μ „μ²΄ ν…μ¤νΈ μ½”λ“

```java
public class ComponentFilterAppConfigTest {

    @Test
    void filterScan() {
        ApplicationContext ac = new AnnotationConfigApplicationContext(ComponentFilterAppConfig.class);
        BeanA beanA = ac.getBean("beanA", BeanA.class);
        assertThat(beanA).isNotNull();

        assertThatThrownBy(() -> ac.getBean("beanB", BeanB.class))
                .isInstanceOf(NoSuchBeanDefinitionException.class);
    }

    @Configuration
    @ComponentScan(
            includeFilters = @Filter(type = FilterType.ANNOTATION, classes = MyIncludeComponent.class),
            excludeFilters = @Filter(type = FilterType.ANNOTATION, classes = MyExcludeComponent.class)
    )
    static class ComponentFilterAppConfig {
    }
}
```
- `includeFilters` μ— `MyIncludeComponent` μ• λ…Έν…μ΄μ…μ„ μ¶”κ°€ν•΄μ„ BeanA κ°€ μ¤ν”„λ§ λΉμ— λ“±λ΅λλ‹¤
- `excludeFilters` μ— `MyExcludeComponent` μ• λ…Έν…μ΄μ…μ„ μ¶”κ°€ν•΄μ„ BeanBλ” μ¤ν”„λ§ λΉμ— λ“±λ΅λμ§€ μ•λ”λ‹¤

### ν•„ν„° μµμ…
- `ANNOTATION` : κΈ°λ³Έκ°’μΌλ΅, μ• λ…Έν…μ΄μ…μ„ μΈμ‹ν•΄μ„ λ™μ‘ν•λ‹¤
- `ASSIGNABLE_TYPE` : μ§€μ •ν• νƒ€μ…κ³Ό μμ‹ νƒ€μ…μ„ μΈμ‹ν•΄μ„ λ™μ‘ν•λ‹¤
- `ASPECTJ` : AspectJ ν¨ν„΄ μ‚¬μ©
- `REGEX` : μ •κ· ν‘ν„μ‹
- `CUSTOM` : `TypeFilter` λΌλ” μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•΄μ„ μ²λ¦¬ν•λ‹¤



## 4. μ¤‘λ³µ λ“±λ΅κ³Ό μ¶©λ
- π§ μ»΄ν¬λ„νΈ μ¤μΊ”μ—μ„ κ°™μ€ λΉ μ΄λ¦„μ„ λ“±λ΅ν•λ©΄ μ–΄λ–»κ² λ κΉ?

1. μλ™ λΉ λ“±λ΅ vs μλ™ λΉ λ“±λ΅
2. μλ™ λΉ λ“±λ΅ vs μλ™ λΉ λ“±λ΅



#### 1. μλ™ λΉ λ“±λ΅ vs μλ™ λΉ λ“±λ΅
- μ»΄ν¬λ„νΈ μ¤μΊ”μ— μν•΄ μλ™μΌλ΅ μ¤ν”„λ§ λΉμ΄ λ“±λ΅λλ”λ°, κ·Έ μ΄λ¦„μ΄ κ°™μ€ κ²½μ°μ—λ” **μ¤ν”„λ§μ΄ μ¤λ¥λ¥Ό λ°μƒ**μ‹ν‚¨λ‹¤
  - `ConflictBeanDefinitionException`

#### 2. μλ™ λΉ λ“±λ΅ vs μλ™ λΉ λ“±λ΅
- π§ λ§μ•½ μλ™μΌλ΅ λ“±λ΅λ λΉκ³Ό μλ™μΌλ΅ λ“±λ΅λ λΉ μ΄λ¦„μ΄ μ¶©λλλ©΄ μ–΄λ–»κ² λ κΉ?
- π“ μλ™ λΉ λ“±λ΅μ΄ μ°μ„ κ¶μ„ κ°€μ§„λ‹¤
```java
@Bean(name = "memoryMemberRepository")
public MemberRepository memberRepository() {
  return new MemoryMemberRepository();
}
```
![overriding_bean](images/2022/11/overriding-bean.png)
- μλ™ λΉμ΄ μλ™ λΉμ„ μ¤λ²„λΌμ΄λ”© ν•΄λ²„λ¦°λ‹¤
#### μµκ·Ό
- μλ™ λΉ λ“±λ΅κ³Ό μλ™ λΉ λ“±λ΅μ΄ μ¶©λμ΄ λ°μƒν•λ©΄ μ¤λ¥κ°€ λ°μƒν•λ„λ΅ κΈ°λ³Έ κ°’μ„ λ°”κΎΈμ—λ‹¤
```java
Consider renaming one of the beans or enabling overriding by setting
spring.main.allow-bean-definition-overriding=true
```
