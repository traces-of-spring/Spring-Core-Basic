# [3] μ¤ν”„λ§ ν•µμ‹¬ μ›λ¦¬ - μ΄ν•΄2 κ°μ²΄ μ§€ν–¥ μ›λ¦¬ μ μ©

### ν•™μµ λ©ν‘

1. μƒλ΅μ΄ μ”κµ¬μ‚¬ν•­μ— λ€ν•΄ κ°λ°ν•κ³  μ΄λ¥Ό κ°λ°ν•λ” λ°μ— μμ–΄μ„ λ°μƒν•λ” λ¬Έμ μ μ„ μ• μ μλ‹¤.
2. κ΄€μ‹¬μ‚¬λ¥Ό λ¶„λ¦¬ν•΄λ³Ό μ μλ‹¤.



μ΄μ „μ— κ°λ°ν–λ μ½”λ“κ°€ μ •λ§ κ°μ²΄ μ§€ν–¥ μ„¤κ³„ μ›μΉ™μ„ μ μ¤€μν–λ”μ§€ ν™•μΈν•΄λ³΄μ. μ΄λ²μ—λ” μ£Όλ¬Έν• κΈμ•΅μ %λ¥Ό ν• μΈν•΄μ£Όλ” μƒλ΅μ΄ μ •λ¥  ν• μΈ μ •μ±…μ„ μ¶”κ°€ν•λ‹¤.

## 1. ν• μΈ μ •μ±…μ„ μ• ν”λ¦¬μΌ€μ΄μ…μ— μ μ©ν•κΈ°

- ν• μΈ μ •μ±…μ„ μ‹¤μ μ μΌλ΅ μ μ©ν•λ ¤λ©΄, ν΄λΌμ΄μ–ΈνΈμΈ `OrderServiceImpl` μ„ κ³ μ³μ•Ό ν•λ‹¤

```java
public class OrderServiceImpl implements OrderService {

    private final MemberRepository memberRepository = new MemoryMemberRepository();
//    private final DiscountPolicy discountPolicy = new FixDiscountPolicy();
    private final DiscountPolicy discountPolicy = new RateDiscountPolicy();
}
```



## 2. λ¬Έμ μ  λ°κ²¬

- μ—­ν• κ³Ό κµ¬ν„μ„ μ¶©μ‹¤ν•κ² λ¶„λ¦¬ν–λ”κ°€? -> O
- λ‹¤ν•μ„±λ„ ν™μ©ν•κ³ , μΈν„°νμ΄μ¤μ™€ κµ¬ν„ κ°μ²΄λ¥Ό λ¶„λ¦¬ν–λ”κ°€? -> O
- OCP, DIP μ™€ κ°™μ€ κ°μ²΄ μ§€ν–¥ μ„¤κ³„ μ›μΉ™μ„ μ¶©μ‹¤ν μ¤€μν–λ”κ°€?
  - κ·Έλ ‡κ² λ³΄μ΄μ§€λ§ μ‚¬μ‹¤μ€ μ•„λ‹λ‹¤

> 1. OCP (Open / Closed Principle) : κ°λ°© - νμ‡„ μ›μΉ™
>
> - μ†ν”„νΈμ›¨μ–΄ μ”μ†λ” ν™•μ¥μ—λ” μ—΄λ ¤ μμΌλ‚ λ³€κ²½μ—λ” λ‹«ν€ μμ–΄μ•Ό ν•λ‹¤
>
> 2. DIP (Dependeny Inversion Principle) : μμ΅΄ κ΄€κ³„ μ—­μ „ μ›μΉ™
>
> - "μ¶”μƒν™”μ— μμ΅΄ν•΄μ•Όμ§€, κµ¬μ²΄ν™”μ— μμ΅΄ν•λ©΄ μ•λλ‹¤."
> - ν΄λΌμ΄μ–ΈνΈ μ½”λ“κ°€ **κµ¬ν„ ν΄λμ¤μ— μμ΅΄ν•μ§€ λ§κ³ , μΈν„°νμ΄μ¤μ— μμ΅΄ν•λΌ**

- DIP : μ£Όλ¬Έ μ„λΉ„μ¤ ν΄λΌμ΄μ–ΈνΈ (`OrderServiceImpl`) μ€ `DiscountPolicy` μΈν„°νμ΄μ¤μ— μμ΅΄ν•λ©΄μ„ DIPλ¥Ό μ§€ν‚¨ κ²ƒ κ°™μ€λ°??
  - μ¶”μƒν™”(μΈν„°νμ΄μ¤) λΏλ§ μ•„λ‹λΌ κµ¬μ²΄ν™”(κµ¬ν„) ν΄λμ¤μ—λ„ μμ΅΄ν•κ³  μλ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤
    - μ¶”μƒν™” μμ΅΄ (μΈν„°νμ΄μ¤ μμ΅΄) : `DiscountPolicy`
    - κµ¬μ²΄ν™” μμ΅΄ (κµ¬ν„ ν΄λμ¤ μμ΅΄) : `FixDiscountPolicy` , `RateDiscountPolicy`
  - DIPλ¥Ό μ„λ°ν•κ³  μλ‹¤

- OCP : λ³€κ²½ν•μ§€ μ•κ³  ν™•μ¥ν•  μ μλ‹¤κ³  ν–λ”λ°???
  - `OrderServiceImpl` μ€ κΈ°λ¥μ„ ν™•μ¥ν•΄μ„ λ³€κ²½ν•λ©΄ ν΄λΌμ΄μ–ΈνΈ μ½”λ“μΈ `OrderServiceImpl` μ— μν–¥μ„ μ¤€λ‹¤
  - λ”°λΌμ„ κΈ°λ¥μ„ ν™•μ¥ν•μ—¬ λ³€κ²½ν•λ” μκ°„ OCPλ¥Ό μ„λ°ν•λ‹¤κ³  ν•  μ μλ‹¤

#### κ²°λ΅ 

- ν΄λΌμ΄μ–ΈνΈ μ½”λ“μΈ `OrderServiceImpl` μ€ `DiscountPolicy` μ μΈν„°νμ΄μ¤ λΏλ§ μ•„λ‹λΌ κµ¬μ²΄ ν΄λμ¤λ„ ν•¨κ» μμ΅΄ν•λ‹¤ --> DIP μ„λ°
- κ·Έλμ„ κµ¬μ²΄ ν΄λμ¤λ¥Ό λ³€κ²½ν•  λ•, ν΄λΌμ΄μ–ΈνΈ μ½”λ“λ„ ν•¨κ» λ³€κ²½ν•΄μ•Ό ν•λ‹¤



###  κ·Έλ¬λ©΄ μ–΄λ–»κ² ν•΄κ²°ν•΄μ•Ό ν•λ”κ°€?

- DIP μ„λ°
  - μ¶”μƒμ—λ§ μμ΅΄ν•λ„λ΅ (μΈν„°νμ΄μ¤μ—λ§ μμ΅΄ν•λ„λ΅) λ³€κ²½ν•΄μ•Ό ν•λ‹¤

#### μΈν„°νμ΄μ¤μ—λ§ μμ΅΄ν•λ„λ΅ μ„¤κ³„λ¥Ό λ³€κ²½ν•μ

```java
public class OrderServiceImpl implements OrderService {

    private final MemberRepository memberRepository = new MemoryMemberRepository();

    private DiscountPolicy discountPolicy; // μΈν„°νμ΄μ¤μ—λ§ μμ΅΄ν•λ„λ΅ μ½”λ“λ¥Ό λ³€κ²½ν•λ‹¤
    
}
```

π¤” κµ¬ν„μ²΄κ°€ μ—†λ”λ° μ–΄λ–»κ² μ½”λ“λ¥Ό μ‹¤ν–‰ν•  μ μμ„κΉ??

- μ‹¤μ  μ‹¤ν–‰μ„ ν•΄λ³΄λ©΄ `NullPointerException` μ΄ λ°μƒν•λ‹¤

π§ **ν•΄κ²°λ°©μ•**

- λ„κµ°κ°€κ°€ ν΄λΌμ΄μ–ΈνΈμΈ `OrderServiceImpl` μ— `DiscountPolicy` μ κµ¬ν„ κ°μ²΄λ¥Ό λ€μ‹  μƒμ„±ν•κ³  μ£Όμ…ν•΄μ£Όμ–΄μ•Ό ν•λ‹¤



## 3. κ΄€μ‹¬μ‚¬μ λ¶„λ¦¬

- κ³µμ—° κΈ°νμλ¥Ό λ§λ“¤κ³ , λ°°μ°μ™€ κ³µμ—° κΈ°νμμ μ±…μ„μ„ ν™•μ‹¤ν λ¶„λ¦¬ν•μ



### AppConfigμ λ“±μ¥

- μ• ν”λ¦¬μΌ€μ΄μ…μ μ „μ²΄ λ™μ‘ λ°©μ‹μ„ κµ¬μ„±(config)ν•κΈ° μ„ν•΄, **κµ¬ν„ κ°μ²΄λ¥Ό μƒμ„±**ν•κ³ , μ—°κ²°ν•λ” **μ±…μ„**μ„ κ°€μ§€λ” λ³„λ„μ μ„¤μ • ν΄λμ¤λ¥Ό λ§λ“¤μ

- `AppConfig.java`

  ```java
  public class AppConfig {
  		public MemberService memberService() {
  				return new MemberServiceImpl(new MemoryMemberRepository());
  		}
  }
  ```

- `MemberServiceImpl`

  ```java
  public class MemberServiceImpl implements MemberService {
  
      private final MemberRepository memberRepository;
  
      // μƒμ„±μλ¥Ό ν†µν•΄ memberRepositoryμ κµ¬ν„μ²΄λ¥Ό μ§€μ •ν•λ‹¤
      public MemberServiceImpl(MemberRepository memberRepository) {
          this.memberRepository = memberRepository;
      } 
  }
  ```

  - μ΄μ  μƒμ„±μλ¥Ό ν†µν•΄ `memberRepository` μ κµ¬ν„μ²΄λ¥Ό μ§€μ •ν•λ―€λ΅, `MemberServiceImpl` μ€ κµ¬μ²΄ν™”λ¥Ό μ „ν€ λ¨λ¥Έλ‹¤
    - μƒμ„±μλ¥Ό ν†µν•΄ κ°μ²΄κ°€ λ“¤μ–΄κ°„λ‹¤ => μƒμ„±μ μ£Όμ…

- λ™μΌν•κ² `OrderServiceImpl` λ„ λ°”κΎΈλ©΄,

- `AppConfig.java`

  ```java
  public class AppConfig {
      public MemberService memberService() {
          return new MemberServiceImpl(new MemoryMemberRepository());
      }
  
      public OrderService orderService() {
          return new OrderServiceImpl(new MemoryMemberRepository(), new FixDiscountPolicy());
      }
  }
  ```

- `OrderServiceImpl`

  ```java
  public class OrderServiceImpl implements OrderService {
  
      private final MemberRepository memberRepository;
      private final DiscountPolicy discountPolicy;
  
      public OrderServiceImpl(MemberRepository memberRepository, DiscountPolicy discountPolicy) {
          this.memberRepository = memberRepository;
          this.discountPolicy = discountPolicy;
      }
  }
  
  ```

##### μ² μ €ν•κ² DIPκ°€ μ§€μΌμ§€κ³  μλ‹¤

- `AppConfig` λ” μ• ν”λ¦¬μΌ€μ΄μ…μ μ‹¤μ  λ™μ‘μ— ν•„μ”ν• **κµ¬ν„ κ°μ²΄λ¥Ό μƒμ„±**ν•λ‹¤
  1. `MemberServiceImpl`
  2. `MemoryMemberRepository`
  3. `OrderServiceImpl`
  4. `FixDiscountPolicy`
- `AppConfig` λ” μƒμ„±ν• κ°μ²΄ μΈμ¤ν„΄μ¤μ μ°Έμ΅°(λ νΌλ°μ¤)λ¥Ό **μƒμ„±μλ¥Ό ν†µν•΄μ„ μ£Όμ…(μ—°κ²°)** ν•΄μ¤€λ‹¤
  - `MemberServiceImpl` -> `MemoryMemberRepository`
  - `OrderServiceImpl` -> `MemoryMemberRepository`, `FixDiscountPolicy`

β­οΈ μ΄μ  μ„¤κ³„ λ³€κ²½μΌλ΅ `MemberServiceImpl` μ€ `MemoryMemberRepository` λ¥Ό μμ΅΄ν•μ§€ μ•λ”λ‹¤

- λ‹¨μ§€ `MemberRepository` μΈν„°νμ΄μ¤λ§ μμ΅΄ν•λ‹¤
- `MemberServiceImpl` μ…μ¥μ—μ„ μƒμ„±μλ¥Ό ν†µν•΄ μ–΄λ–¤ κµ¬ν„ κ°μ²΄κ°€ λ“¤μ–΄μ¬μ§€ (μ£Όμ…λ μ§€)λ” μ• μ μ—†λ‹¤
- `MemberServiceImpl` μ μƒμ„±μλ¥Ό ν†µν•΄μ„ μ–΄λ–¤ κµ¬ν„ κ°μ²΄λ¥Ό μ£Όμ…ν• μ§€λ” μ¤μ§ μ™Έλ¶€ `AppConfig` μ—μ„ κ²°μ •λλ‹¤
- `MemberServiceImpl` μ€ μ΄μ λ¶€ν„° **μμ΅΄ κ΄€κ³„μ— λ€ν• κ³ λ―Όμ€ μ™Έλ¶€**μ— λ§΅κΈ°κ³  μ‹¤ν–‰μ—λ§ μ§‘μ¤‘ν•λ©΄ λλ‹¤



β­οΈ κ°μ²΄μ μƒμ„±κ³Ό μ—°κ²°μ€ `AppConfig`κ°€ λ‹΄λ‹Ήν•λ‹¤

- DIP μ™„μ„± : `MemberServiceImpl` μ€ `MemberRepository` μΈ μ¶”μƒμ—λ§ μμ΅΄ν•λ©΄ λλ‹¤. μ΄μ  κµ¬μ²΄ ν΄λμ¤λ¥Ό λ°λΌλ„ λλ‹¤
- **κ΄€μ‹¬μ‚¬μ λ¶„λ¦¬** : κ°μ²΄λ¥Ό μƒμ„±ν•κ³  μ—°κ²°ν•λ” μ—­ν• κ³Ό μ‹¤ν–‰ν•λ” μ—­ν• μ΄ λ…ν™•ν λ¶„λ¦¬λμ—λ‹¤
- `appConfig` κ°μ²΄λ” `memoryMemberRepository` κ°μ²΄λ¥Ό μƒμ„±ν•κ³  κ·Έ μ°Έμ΅°κ°’μ„ `memberServiceImpl` μ„ μƒμ„±ν•λ©΄μ„ μƒμ„±μλ΅ μ „λ‹¬ν•λ‹¤

β­οΈ ν΄λΌμ΄μ–ΈνΈμΈ `memberServiceImpl` μ…μ¥μ—μ„ λ³΄λ©΄ μμ΅΄κ΄€κ³„λ¥Ό λ§μΉ μ™Έλ¶€μ—μ„ μ£Όμ…ν•΄μ£Όλ” κ²ƒ κ°™λ‹¤κ³  ν•΄μ„ **DI (Dependency Injection)** λλ” μμ΅΄ κ΄€κ³„ μ£Όμ…(μμ΅΄μ„± μ£Όμ…)μ΄λΌκ³  ν•λ‹¤.



### μ •λ¦¬

- `AppConfig` λ¥Ό ν†µν•΄μ„ κ΄€μ‹¬μ‚¬λ¥Ό ν™•μ‹¤ν•κ² λ¶„λ¦¬ν–λ‹¤
- λ°°μ—­, λ°°μ°λ¥Ό μƒκ°ν•΄λ³΄μ
- `AppConfig` λ” κ³µμ—° κΈ°νμμ΄λ‹¤
- `AppConfig` λ” κµ¬μ²΄ ν΄λμ¤λ¥Ό μ„ νƒν•λ‹¤. λ°°μ—­μ— λ§λ” λ‹΄λ‹Ή λ°°μ°λ¥Ό μ„ νƒν•λ‹¤. μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ–΄λ–»κ² λ™μ‘ν•΄μ•Ό ν•μ§€ μ „μ²΄ κµ¬μ„±μ„ μ±…μ„μ§„λ‹¤
- μ΄μ  κ° λ°°μ°λ“¤μ€ λ‹΄λ‹Ή κΈ°λ¥μ„ μ‹¤ν–‰ν•λ” μ±…μ„λ§ μ§€λ©΄ λλ‹¤
- `OrderServiceImpl` μ€ κΈ°λ¥μ„ μ‹¤ν–‰ν•λ” μ±…μ„λ§ μ§€λ©΄ λλ‹¤



## 4. AppConfig λ¦¬ν©ν„°λ§

- μ§€κΈμ `AppConfig` λ” μ¤‘λ³µμ΄ μκ³ , μ—­ν• μ— λ”°λ¥Έ κµ¬ν„μ΄ μ μ•λ³΄μΈλ‹¤

### μ¤‘λ³µμ„ μ κ±°ν•κ³ , μ—­ν• μ— λ”°λ¥Έ κµ¬ν„μ΄ λ³΄μ΄λ„λ΅ λ¦¬ν©ν„°λ§ ν•μ

```java
public class AppConfig {

    public MemberService memberService() {
        return new MemberServiceImpl(memberRepository());
    }

    private MemoryMemberRepository memberRepository() {
        return new MemoryMemberRepository();
    }

    public OrderService orderService() {
        return new OrderServiceImpl(memberRepository(), discountPolicy());
    }

    public DiscountPolicy discountPolicy() {
        return new FixDiscountPolicy();
    }
}
```

#### μ¥μ 

- λ©”μ†λ“λ…λ§ λ³΄λ” μκ°„ μ—­ν• μ΄ μ λ“λ¬λ‚λ‹¤ (`AppConfig` λ¥Ό λ³΄λ©΄ μ—­ν• κ³Ό κµ¬ν„ ν΄λμ¤κ°€ ν• λμ— λ“¤μ–΄μ™€μ„ μ „μ²΄ μ• ν”λ¦¬μΌ€μ΄μ… κµ¬μ„±μ„ ν• λμ— νμ•…ν•  μ μλ‹¤)
- μ¤‘λ³µμ΄ μ κ±° λμ—μΌλ―€λ΅ (`new MemoryMemberRepository()`), μ΄μ  `MemoryMemberRepository` λ¥Ό λ‹¤λ¥Έ κµ¬ν„μ²΄λ΅ λ³€κ²½ν•  λ• ν• λ¶€λ¶„λ§ λ³€κ²½ν•λ©΄ λλ‹¤



## 5. μƒλ΅μ΄ κµ¬μ΅°μ™€ ν• μΈ μ •μ±… μ μ©

  `AppConfig` μ λ“±μ¥μΌλ΅ μ• ν”λ¦¬μΌ€μ΄μ…μ΄ μ‚¬μ© μμ—­κ³Ό κ°μ²΄λ¥Ό μƒμ„±ν•κ³ , κµ¬μ„±ν•λ” (Configuration) ν•λ” μμ—­μΌλ΅ λ¶„λ¦¬λμ—λ‹¤

- ν• μΈ μ •μ±…μ„ `RateDiscountPolicy` λ΅ λ³€κ²½ν•΄λ„ κµ¬μ„± μμ—­λ§ μν–¥μ„ λ°›κ³ , μ‚¬μ© μμ—­μ€ μ „ν€ μν–¥μ„ λ°›μ§€ μ•λ”λ‹¤