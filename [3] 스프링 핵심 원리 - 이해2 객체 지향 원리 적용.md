# [3] 스프링 핵심 원리 - 이해2 객체 지향 원리 적용

### 학습 목표

1. 새로운 요구사항에 대해 개발하고 이를 개발하는 데에 있어서 발생하는 문제점을 알 수 있다.
2. 관심사를 분리해볼 수 있다.



이전에 개발했던 코드가 정말 객체 지향 설계 원칙을 잘 준수했는지 확인해보자. 이번에는 주문한 금액의 %를 할인해주는 새로운 정률 할인 정책을 추가한다.

### 할인 정책을 애플리케이션에 적용하기

- 할인 정책을 실제적으로 적용하려면, 클라이언트인 `OrderServiceImpl` 을 고쳐야 한다

```java
public class OrderServiceImpl implements OrderService {

    private final MemberRepository memberRepository = new MemoryMemberRepository();
//    private final DiscountPolicy discountPolicy = new FixDiscountPolicy();
    private final DiscountPolicy discountPolicy = new RateDiscountPolicy();
}
```

#### 문제점 발견

- 역할과 구현을 충실하게 분리했는가? -> O
- 다형성도 활용하고, 인터페이스와 구현 객체를 분리했는가? -> O
- OCP, DIP 와 같은 객체 지향 설계 원칙을 충실히 준수했는가?
  - 그렇게 보이지만 사실은 아니다

> 1. OCP (Open / Closed Principle) : 개방 - 폐쇄 원칙
>
> - 소프트웨어 요소는 확장에는 열려 있으나 변경에는 닫혀 있어야 한다
>
> 2. DIP (Dependeny Inversion Principle) : 의존 관계 역전 원칙
>
> - "추상화에 의존해야지, 구체화에 의존하면 안된다."
> - 클라이언트 코드가 **구현 클래스에 의존하지 말고, 인터페이스에 의존하라**

- DIP : 주문 서비스 클라이언트 (`OrderServiceImpl`) 은 `DiscountPolicy` 인터페이스에 의존하면서 DIP를 지킨 것 같은데??
  - 추상화(인터페이스) 뿐만 아니라 구체화(구현) 클래스에도 의존하고 있는 것을 확인할 수 있다
    - 추상화 의존 (인터페이스 의존) : `DiscountPolicy`
    - 구체화 의존 (구현 클래스 의존) : `FixDiscountPolicy` , `RateDiscountPolicy`
  - DIP를 위반하고 있다

- OCP : 변경하지 않고 확장할 수 있다고 했는데???
  - `OrderServiceImpl` 은 기능을 확장해서 변경하면 클라이언트 코드인 `OrderServiceImpl` 에 영향을 준다
  - 따라서 기능을 확장하여 변경하는 순간 OCP를 위반한다고 할 수 있다

#### 결론

- 클라이언트 코드인 `OrderServiceImpl` 은 `DiscountPolicy` 의 인터페이스 뿐만 아니라 구체 클래스도 함께 의존한다 --> DIP 위반
- 그래서 구체 클래스를 변경할 때, 클라이언트 코드도 함께 변경해야 한다



###  그러면 어떻게 해결해야 하는가?

- DIP 위반
  - 추상에만 의존하도록 (인터페이스에만 의존하도록) 변경해야 한다

#### 인터페이스에만 의존하도록 설계를 변경하자

```java
public class OrderServiceImpl implements OrderService {

    private final MemberRepository memberRepository = new MemoryMemberRepository();

    private DiscountPolicy discountPolicy; // 인터페이스에만 의존하도록 코드를 변경한다
    
}
```

🤔 구현체가 없는데 어떻게 코드를 실행할 수 있을까??

- 실제 실행을 해보면 `NullPointerException` 이 발생한다

🧐 **해결방안**

- 누군가가 클라이언트인 `OrderServiceImpl` 에 `DiscountPolicy` 의 구현 객체를 대신 생성하고 주입해주어야 한다

