# [8] ìŠ¤í”„ë§ í•µì‹¬ ì›ë¦¬ - ë¹ˆ ìƒëª…ì£¼ê¸° ì½œë°±

### í•™ìŠµ ëª©í‘œ

1. ë¹ˆ ìƒëª…ì£¼ê¸° ì½œë°± ì‹œì‘ì— ëŒ€í•´ ì•ˆë‹¤.
2. ë¹ˆ ë“±ë¡ ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œë¥¼ ì§€ì •í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‹¤.

## 1. ë¹ˆ ìƒëª…ì£¼ê¸° ì½œë°± ì‹œì‘

- ë°ì´í„°ë² ì´ìŠ¤ ì»¤ë„¥ì…˜ í’€ì´ë‚˜, ë„¤íŠ¸ì›Œí¬ ì†Œì¼“ì²˜ëŸ¼ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ ì‹œì ì— í•„ìš”í•œ ì—°ê²°ì„ ë¯¸ë¦¬ í•´ë‘ê³ , ì• í”Œë¦¬ì¼€ì´ì…˜ ì¢…ë£Œ ì‹œì ì— ì—°ê²°ì„ ëª¨ë‘ ì¢…ë£Œí•˜ëŠ” ì‘ì—…ì„ ì§„í–‰í•˜ë ¤ë©´, ê°ì²´ì˜ ì´ˆê¸°í™”ì™€ ì¢…ë£Œ ì‘ì—…ì´ í•„ìš”í•˜ë‹¤.

> ####  Database Connection Pool
> -

#### ì™¸ë¶€ ë„¤íŠ¸ì›Œí¬ì— ë¯¸ë¦¬ ì—°ê²°í•˜ëŠ” ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì˜ˆì œ
```java
public class NetworkClient {
    private String url;

    public NetworkClient() {
        System.out.println("ìƒì„±ì í˜¸ì¶œ, url = " + url);
        connect();
        call("ì´ˆê¸°í™” ì—°ê²° ë©”ì‹œì§€");
    }

    public void setUrl(String url) {
        this.url = url;
    }

    // ì„œë¹„ìŠ¤ ì‹œì‘ ì‹œ í˜¸ì¶œ
    public void connect() {
        System.out.println("connect : " + url);
    }

    public void call(String message) {
        System.out.println("call : " + url + " message = " + message);
    }

    // ì„œë¹„ìŠ¤ ì¢…ë£Œ ì‹œ í˜¸ì¶œ
    public void disconnect() {
        System.out.println("close : " + url);
    }
}
```
#### ìŠ¤í”„ë§ ë¹ˆ ë¼ì´í”„ì‚¬ì´í´ í…ŒìŠ¤íŠ¸
```java
public class BeanLifeCycleTest {

    @Test
    public void lifeCycleTest() {
        ConfigurableApplicationContext ac = new AnnotationConfigApplicationContext(LifeCycleConfig.class);
        NetworkClient client = ac.getBean(NetworkClient.class);
        ac.close();
    }

    @Configuration
    static class LifeCycleConfig {

        @Bean
        public NetworkClient networkClient() {
            NetworkClient networkClient = new NetworkClient();
            networkClient.setUrl("http://hello-spring.dev");

            return networkClient;
        }
    }
}
```
![beanlifecycle](images/2022/11/beanlifecycle.png)
- ìƒì„±ì ë¶€ë¶„ì„ ë³´ë©´ url ì •ë³´ ì—†ì´ connectê°€ í˜¸ì¶œë˜ê³  ìˆë‹¤
- ê°ì²´ ìƒì„± ë‹¨ê³„ì—ëŠ” urlì´ ì—†ê³ , ê°ì²´ë¥¼ ìƒì„±í•œ ë‹¤ìŒì— ì™¸ë¶€ì—ì„œ setter ì£¼ì…ì„ í†µí•´ì„œ `setUrl()` ì´ í˜¸ì¶œë˜ì–´ì•¼ urlì´ ì¡´ì¬í•˜ê²Œ ëœë‹¤

### ìŠ¤í”„ë§ ë¹ˆì˜ ë¼ì´í”„ ì‚¬ì´í´
- ê°ì²´ ìƒì„± â¡ï¸ ì˜ì¡´ ê´€ê³„ ì£¼ì…
- ìŠ¤í”„ë§ ë¹ˆì€ ê°ì²´ë¥¼ ìƒì„±í•˜ê³ , ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ë‹¤ ëë‚œ ë‹¤ìŒì—ì•¼ í•„ìš”í•œ ë°ì´í„°ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì¤€ë¹„ê°€ ì™„ë£Œëœë‹¤.
- ê·¸ë˜ì„œ, ì´ˆê¸°í™” ì‘ì—…ì€ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ëª¨ë‘ ì™„ë£Œë˜ê³  ë‚œ ë‹¤ìŒì— í˜¸ì¶œí•´ì•¼ í•œë‹¤
- ğŸ§ ê°œë°œìê°€ ì–´ë–»ê²Œ ìŠ¤í”„ë§ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ ì•Œê¹Œ?
    - ê·¸ë˜ì„œ, ìŠ¤í”„ë§ì€ ì˜ì¡´ê´€ê³„ ì£¼ì…ì´ ì™„ë£Œë˜ë©´ ìŠ¤í”„ë§ ë¹ˆì—ê²Œ ì½œë°± ë©”ì„œë“œë¥¼ í†µí•´ì„œ ì´ˆê¸°í™” ì‹œì ì„ ì•Œë ¤ì£¼ëŠ” ë‹¤ì–‘í•œ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤
    - ê·¸ë¦¬ê³ , ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆê°€ ì¢…ë£Œë˜ê¸° ì§ì „ì— ì†Œë©¸ ì½œë°±ì„ ì¤€ë‹¤

#### ìŠ¤í”„ë§ ë¹ˆì˜ ì´ë²¤íŠ¸ ë¼ì´í”„ì‚¬ì´í´
- **ìŠ¤í”„ë§ ì»¨í…Œì´ë„ˆ ìƒì„± â¡ï¸ ìŠ¤í”„ë§ ë¹ˆ ìƒì„± â¡ï¸ ì˜ì¡´ê´€ê³„ ì£¼ì… â¡ï¸ ì´ˆê¸°í™” ì½œë°± â¡ï¸ ì‚¬ìš© â¡ï¸ ì†Œë©¸ ì „ ì½œë°± â¡ï¸ ìŠ¤í”„ë§ ì¢…ë£Œ**
- ì´ˆê¸°í™” ì½œë°± : ìŠ¤í”„ë§ ë¹ˆì´ ìƒì„±ë˜ê³ , ìŠ¤í”„ë§ ë¹ˆì˜ ì˜ì¡´ ê´€ê³„ ì£¼ì…ì´ ì™„ë£Œëœ í›„ì— í˜¸ì¶œ
- ì†Œë©¸ì „ ì½œë°± : ìŠ¤í”„ë§ ë¹ˆì´ ì†Œë©¸ë˜ê¸° ì§ì „ì— í˜¸ì¶œ

> #### ğŸ“Œ ì°¸ê³ 
> - ê°ì²´ì˜ ìƒì„±ê³¼ ì´ˆê¸°í™”ë¥¼ ë¶„ë¦¬í•˜ì
> - ìƒì„±ìëŠ” í•„ìˆ˜ ì •ë³´(íŒŒë¼ë¯¸í„°)ë¥¼ ë°›ê³ , ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•´ì„œ ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ì±…ì„ì„ ê°€ì§„ë‹¤
> - ì´ˆê¸°í™”ëŠ” ìƒì„±ëœ ê°’ë“¤ì„ í™œìš©í•´ì„œ ì™¸ë¶€ ì»¤ë„¥ì…˜ì„ ì—°ê²°í•˜ëŠ” ë“±ì˜ ë¬´ê±°ìš´ ë™ì‘ì„ ìˆ˜í–‰í•œë‹¤
> - ê·¸ë˜ì„œ, ìƒì„±ì ì•ˆì—ì„œ ë¬´ê±°ìš´ ì´ˆê¸°í™” ì‘ì—…ì„ ê°™ì´ í•˜ëŠ” ê²ƒ ë³´ë‹¤ëŠ”, ê°ì²´ë¥¼ ìƒì„±í•˜ëŠ” ë¶€ë¶„ê³¼ ì´ˆê¸°í™” í•˜ëŠ” ë¶€ë¶„ì„ ëª…í™•í•˜ê²Œ ë‚˜ëˆ„ëŠ” ê²ƒì´ ì¢‹ë‹¤!

### ìŠ¤í”„ë§ì´ ì§€ì›í•˜ëŠ” ë¹ˆ ìƒëª…ì£¼ê¸° ì½œë°±
1. ì¸í„°í˜ì´ìŠ¤ InitializingBean, DisposableBean
2. ì„¤ì • ì •ë³´ì— ì´ˆê¸°í™” ë©”ì„œë“œ, ì¢…ë£Œ ë©”ì„œë“œ ì§€ì •
3. @PostConstuct, @PreDestroy



### 1. ì¸í„°í˜ì´ìŠ¤ InitializingBean, DisposableBean

```java
public class NetworkClient implements InitializingBean, DisposableBean {
      private String url;

      public NetworkClient() {
				System.out.println("ìƒì„±ì í˜¸ì¶œ, url = " + url); 	
			}

      public void setUrl(String url) {
          this.url = url;
			}

      //ì„œë¹„ìŠ¤ ì‹œì‘ì‹œ í˜¸ì¶œ
      public void connect() {
                System.out.println("connect: " + url);
            }
            public void call(String message) {
                System.out.println("call: " + url + " message = " + message);
      }

      //ì„œë¹„ìŠ¤ ì¢…ë£Œì‹œ í˜¸ì¶œ
      public void disConnect() {
                System.out.println("close + " + url);
            }
            @Override
            public void afterPropertiesSet() throws Exception {
            	connect();
            	call();
            }

      @Override
      public void destroy() throws Exception{
      		disConnect();
      }
```

- ë‹¨ì 
  - ìŠ¤í”„ë§ ì „ìš© ì¸í„°í˜ì´ìŠ¤
  - í•´ë‹¹ ì½”ë“œê°€ ì¸í„°í˜ì´ìŠ¤ì— ì˜ì¡´í•œë‹¤ëŠ” ë‹¨ì 
  - ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œì˜ ì´ë¦„ ë³€ê²½ ë¶ˆê°€ëŠ¥
  - ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ì ìš© ë¶ˆê°€ëŠ¥

### 2. ë¹ˆ ë“±ë¡ ì´ˆê¸°í™”, ì†Œë©¸ ë©”ì„œë“œ ì§€ì •

```java
public class NetworkClient {
      private String url;
      public NetworkClient() {
        System.out.println("ìƒì„±ì í˜¸ì¶œ, url = " + url);
      }

  		public void setUrl(String url) {
          this.url = url;
			}
      //ì„œë¹„ìŠ¤ ì‹œì‘ì‹œ í˜¸ì¶œ
      public void connect() {
                System.out.println("connect: " + url);
      }

  		public void call(String message) {
                System.out.println("call: " + url + " message = " + message);
      }
      //ì„œë¹„ìŠ¤ ì¢…ë£Œì‹œ í˜¸ì¶œ
      public void disConnect() {
                System.out.println("close + " + url);
      }
      public void init() {
         System.out.println("init ");
        connect();
        call();
      }

  		public void close() {
        System.out.println("NetworkClient.close");
        disConnect();
      }
```

- ë©”ì„œë“œ ì´ë¦„ì„ ììœ ë¡­ê²Œ ì¤„ ìˆ˜ ìˆìŒ
- ìŠ¤í”„ë§ ë¹ˆì´ ì•„ë‹ˆë¼ì„œ ìŠ¤í”„ë§ ì½”ë“œì— ì˜ì¡´í•˜ì§€ ì•ŠìŒ



### 3. ì• ë…¸í…Œì´ì…˜ @PostConstruct, @PreDestroy

```java
package hello.core.lifecycle;
  import javax.annotation.PostConstruct;
  import javax.annotation.PreDestroy;
  public class NetworkClient {
      private String url;
      public NetworkClient() {
System.out.println("ìƒì„±ì í˜¸ì¶œ, url = " + url); }
      public void setUrl(String url) {
          this.url = url;
      }

      public void connect() {
      		System.out.println("connect");
      }

  		public void call(String message) {
        System.out.println("call: " + url + " message = " + message);
      }
      //ì„œë¹„ìŠ¤ ì¢…ë£Œì‹œ í˜¸ì¶œ
      public void disConnect() {
              System.out.println("close + " + url);
          }
          @PostConstruct
          public void init() {
      System.out.println("NetworkClient.init"); connect();
      call("ì´ˆê¸°í™” ì—°ê²° ë©”ì‹œì§€");
      }
          @PreDestroy
          public void close() {
              System.out.println("NetworkClient.close");
              disConnect();
          }
}
```

- ìµœì‹  ìŠ¤í”„ë§ì—ì„œ ê°€ì¥ ê¶Œì¥
- ì• ë…¸í…Œì´ì…˜ í•˜ë‚˜ë§Œ ë¶™ì´ë©´ ë˜ì„œ ë§¤ìš° í¸ë¦¬í•¨
- ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ëŠ” ì ìš©í•˜ì§€ ëª»í•¨
  - ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì´ˆê¸°í™”, ì¢…ë£Œí•´ì•¼ í•˜ë©´ @Beanì˜ ê¸°ëŠ¥ì„ ì‚¬ìš©í•´ì•¼ í•¨
